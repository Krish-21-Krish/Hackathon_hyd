{% extends "base.html" %}

{% block content %}
<div class="container my-5 gsap-page">
    <h1 class="text-center mb-4 gsap-title">üìù Question Paper Generator</h1>
    
    <!-- Upload Section -->
    <div class="card mb-4 gsap-card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">üìÅ Upload Question Bank</h5>
        </div>
        <div class="card-body">
            <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
                <div class="row align-items-end">
                    <div class="col-md-8">
                        <label for="file" class="form-label">Select CSV file</label>
                        <input type="file" class="form-control" id="file" name="file" accept=".csv" required>
                        <small class="text-muted">
                            Format: id, subject, unit, topic, question_text, question_type, difficulty, marks
                        </small>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary w-100 gsap-btn">
                            Upload
                        </button>
                    </div>
                </div>
            </form>

            {% if stats %}
            <div class="mt-3">
                <strong>üìä Current Question Bank:</strong>
                <ul class="list-unstyled ms-3">
                    {% for subj, count in stats.items() %}
                    <li>
                        {{ subj }}: {{ count }} questions
                        {% if marks_distribution[subj] %}
                        <small class="text-muted">
                            (
                            {% for marks, cnt in marks_distribution[subj].items() %}
                                {{ cnt }}√ó{{ marks }}m{% if not loop.last %}, {% endif %}
                            {% endfor %}
                            )
                        </small>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Generate Section -->
    <div class="card gsap-card">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0">‚öôÔ∏è Configure Question Paper</h5>
        </div>
        <div class="card-body">
            <form action="{{ url_for('generate_paper') }}" method="post">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Subject *</label>
                        <select class="form-select" name="subject" required>
                            {% for subj in subjects %}
                            <option value="{{ subj }}">{{ subj }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Paper Title</label>
                        <input type="text" class="form-control" name="paper_title"
                               value="Question Paper">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Duration (minutes)</label>
                        <input type="number" class="form-control" name="duration" value="90">
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <h6 class="text-success">üìã Question Distribution</h6>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label">4 Marks Questions</label>
                        <input type="number" class="form-control" name="marks_4_count" value="5">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label">6 Marks Questions</label>
                        <input type="number" class="form-control" name="marks_6_count" value="5">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label">10 Marks Questions</label>
                        <input type="number" class="form-control" name="marks_10_count" value="1">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Instructions</label>
                    <textarea class="form-control" name="instructions" rows="3"></textarea>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-success btn-lg gsap-btn">
                        üéØ Generate Question Paper
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Flash Messages -->
{% with messages = get_flashed_messages() %}
{% if messages %}
<div class="position-fixed bottom-0 end-0 p-3" style="z-index:11">
    {% for message in messages %}
    <div class="toast show gsap-toast">
        <div class="toast-body">{{ message }}</div>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

<!-- GSAP -->
<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>

<script>
/* Page load */
gsap.from(".gsap-page", {
    opacity: 0,
    y: 30,
    duration: 0.7,
    ease: "power2.out"
});

/* Cards flip-in */
gsap.from(".gsap-card", {
    rotateY: 15,
    opacity: 0,
    y: 40,
    duration: 0.8,
    stagger: 0.2,
    transformOrigin: "center",
    ease: "power3.out"
});

/* Hover 3D flip */
document.querySelectorAll(".gsap-card").forEach(card => {
    card.addEventListener("mouseenter", () => {
        gsap.to(card, { rotateY: 3, scale: 1.02, duration: 0.3 });
    });
    card.addEventListener("mouseleave", () => {
        gsap.to(card, { rotateY: 0, scale: 1, duration: 0.3 });
    });
});

/* Button interaction */
document.querySelectorAll(".gsap-btn").forEach(btn => {
    btn.addEventListener("mousedown", () =>
        gsap.to(btn, { scale: 0.96, duration: 0.1 })
    );
    btn.addEventListener("mouseup", () =>
        gsap.to(btn, { scale: 1, duration: 0.1 })
    );
});

/* Toast animation */
gsap.from(".gsap-toast", {
    x: 100,
    opacity: 0,
    duration: 0.4,
    stagger: 0.1,
    ease: "power2.out"
});
</script>

{% endblock %}
